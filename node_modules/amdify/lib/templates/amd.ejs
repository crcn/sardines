define([<%-["\"require\""].concat(dependencies.map(function(dep) {
  return "\"" + dep.name.replace(".js", "") + "\"";
})).join(", ") %>], function(require) {

    var __dirname = "<%-__dirname %>",
    __filename    = "<%-__filename %>",
    module        = { exports: {} },
    exports       = module.exports,
    define        = undefined,
    window        = exports,
    global        = window;

    <%
      dependencies.forEach(function(dep) {
        content = content.replace(new RegExp("[\"\']"+dep.relPath+"[\"\']", "g"), "\""+dep.name.replace(".js", "")+"\"")
      });
    %>

    <%-content %>

    return module.exports;
});